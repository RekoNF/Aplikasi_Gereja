<!DOCTYPE html>
<html lang="id" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GKI â€” Gereja Kristen Indonesia</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.6/JsBarcode.all.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  :root {
    --bg: #FBF3D1;
    --surface: #DEDED1;
    --surface2: #C5C7BC;
    --muted: #B6AE9F;
    --text: #2a2a2a;
    --text2: #555;
    --accent: #7a6f5a;
    --accent2: #a08c6e;
    --card: #fff;
    --shadow: 0 4px 24px rgba(0,0,0,0.08);
    --radius: 16px;
    --nav-h: 64px;
  }
  [data-theme="dark"] {
    --bg: #222831;
    --surface: #393E46;
    --surface2: #948979;
    --muted: #DFD0B8;
    --text: #DFD0B8;
    --text2: #b0a090;
    --accent: #DFD0B8;
    --accent2: #948979;
    --card: #393E46;
    --shadow: 0 4px 24px rgba(0,0,0,0.3);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Poppins', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    transition: background 0.3s, color 0.3s;
  }
  /* NAVBAR */
  .navbar {
    position: fixed; top: 0; left: 0; right: 0; z-index: 100;
    height: var(--nav-h);
    background: var(--card);
    box-shadow: var(--shadow);
    display: flex; align-items: center; padding: 0 24px;
    justify-content: space-between;
  }
  .nav-logo {
    display: flex; align-items: center; gap: 10px;
    font-weight: 700; font-size: 1.1rem; color: var(--text);
  }
  .nav-logo img { height: 40px; object-fit: contain; }
  .nav-actions { display: flex; align-items: center; gap: 12px; }
  .btn-icon {
    background: var(--surface); border: none; border-radius: 50%;
    width: 38px; height: 38px; cursor: pointer; display: flex;
    align-items: center; justify-content: center; color: var(--text);
    font-size: 1.1rem; transition: background 0.2s;
  }
  .btn-icon:hover { background: var(--surface2); }
  /* MAIN LAYOUT */
  .main-wrap {
    padding-top: var(--nav-h);
    display: flex;
    min-height: 100vh;
  }
  /* SIDEBAR NAV */
  .sidebar {
    width: 220px; flex-shrink: 0;
    background: var(--card);
    box-shadow: var(--shadow);
    padding: 24px 16px;
    position: fixed; top: var(--nav-h); left: 0; bottom: 0;
    overflow-y: auto;
    transition: transform 0.3s;
    z-index: 50;
  }
  .sidebar-nav { list-style: none; display: flex; flex-direction: column; gap: 4px; }
  .sidebar-nav li a {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 14px; border-radius: 10px;
    color: var(--text2); font-size: 0.9rem; font-weight: 500;
    text-decoration: none; transition: all 0.2s;
  }
  .sidebar-nav li a:hover, .sidebar-nav li a.active {
    background: var(--surface); color: var(--text);
  }
  .sidebar-nav li a .icon { font-size: 1.1rem; }
  .sidebar-section { font-size: 0.7rem; font-weight: 700; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; padding: 16px 14px 6px; }
  /* CONTENT */
  .content {
    margin-left: 220px;
    flex: 1; padding: 32px;
    min-height: calc(100vh - var(--nav-h));
  }
  /* PAGES */
  .page { display: none; animation: fadeIn 0.3s; }
  .page.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
  /* CARDS */
  .card {
    background: var(--card); border-radius: var(--radius);
    box-shadow: var(--shadow); padding: 24px;
    margin-bottom: 24px;
  }
  .card-title { font-weight: 700; font-size: 1.1rem; margin-bottom: 16px; }
  /* AUTH PAGES */
  .auth-wrap {
    min-height: 100vh; display: flex; align-items: center; justify-content: center;
    background: var(--bg); padding: 24px;
  }
  .auth-card {
    background: var(--card); border-radius: 24px; box-shadow: var(--shadow);
    padding: 40px; width: 100%; max-width: 440px;
  }
  .auth-logo { text-align: center; margin-bottom: 24px; }
  .auth-logo img { height: 60px; }
  .auth-title { text-align: center; font-size: 1.4rem; font-weight: 700; margin-bottom: 6px; }
  .auth-sub { text-align: center; color: var(--text2); font-size: 0.85rem; margin-bottom: 28px; }
  /* FORM */
  .form-group { margin-bottom: 16px; }
  .form-group label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 6px; color: var(--text2); }
  .form-group input, .form-group select, .form-group textarea {
    width: 100%; padding: 12px 16px; border-radius: 12px;
    border: 2px solid var(--surface2); background: var(--surface);
    color: var(--text); font-family: 'Poppins', sans-serif; font-size: 0.9rem;
    transition: border 0.2s;
  }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    outline: none; border-color: var(--accent);
  }
  .btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    padding: 12px 24px; border-radius: 12px; font-family: 'Poppins', sans-serif;
    font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s;
    border: none;
  }
  .btn-primary { background: var(--accent); color: var(--bg); }
  .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
  .btn-outline { background: transparent; border: 2px solid var(--accent); color: var(--accent); }
  .btn-outline:hover { background: var(--accent); color: var(--bg); }
  .btn-block { width: 100%; }
  .btn-sm { padding: 8px 16px; font-size: 0.8rem; border-radius: 8px; }
  /* AUTH LINK */
  .auth-link { text-align: center; margin-top: 16px; font-size: 0.85rem; color: var(--text2); }
  .auth-link a { color: var(--accent); font-weight: 600; text-decoration: none; }
  /* DASHBOARD */
  .greeting { font-size: 1.6rem; font-weight: 800; margin-bottom: 4px; }
  .greeting-sub { color: var(--text2); font-size: 0.9rem; margin-bottom: 28px; }
  .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 28px; }
  .stat-card {
    background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow);
    padding: 20px; display: flex; flex-direction: column; gap: 8px;
  }
  .stat-icon { font-size: 1.8rem; }
  .stat-label { font-size: 0.8rem; color: var(--text2); font-weight: 500; }
  .stat-val { font-size: 1.5rem; font-weight: 800; }
  /* IBADAH SCHEDULE */
  .ibadah-list { display: flex; flex-direction: column; gap: 14px; }
  .ibadah-item {
    background: var(--surface); border-radius: 12px; padding: 16px 20px;
    display: flex; justify-content: space-between; align-items: center;
  }
  .ibadah-time { font-weight: 700; font-size: 1.1rem; }
  .ibadah-label { font-size: 0.8rem; color: var(--text2); }
  .countdown-badge {
    background: var(--accent); color: var(--bg); border-radius: 20px;
    padding: 4px 14px; font-size: 0.78rem; font-weight: 600;
  }
  /* CALENDAR */
  .cal-grid {
    display: grid; grid-template-columns: repeat(7, 1fr);
    gap: 4px; text-align: center;
  }
  .cal-day { padding: 8px 4px; border-radius: 8px; font-size: 0.85rem; }
  .cal-day.header { font-weight: 700; color: var(--text2); font-size: 0.75rem; }
  .cal-day.today { background: var(--accent); color: var(--bg); font-weight: 700; }
  .cal-day.ibadah { background: var(--surface); font-weight: 600; }
  .cal-day.empty { opacity: 0; }
  /* MEMBER CARD */
  .member-card-preview {
    width: 340px; height: 210px;
    background: linear-gradient(135deg, #222831 0%, #393E46 60%, #948979 100%);
    border-radius: 16px; padding: 20px;
    color: #DFD0B8; position: relative; overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    font-family: 'Poppins', sans-serif;
  }
  .member-card-preview::before {
    content: ''; position: absolute; top: -40px; right: -40px;
    width: 140px; height: 140px; border-radius: 50%;
    background: rgba(223,208,184,0.08);
  }
  .member-card-preview::after {
    content: ''; position: absolute; bottom: -30px; left: 60px;
    width: 100px; height: 100px; border-radius: 50%;
    background: rgba(148,137,121,0.12);
  }
  .mc-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
  .mc-logo { font-size: 0.7rem; font-weight: 700; letter-spacing: 1px; opacity: 0.7; }
  .mc-komisii { font-size: 0.65rem; background: rgba(223,208,184,0.2); padding: 3px 8px; border-radius: 20px; }
  .mc-photo {
    width: 52px; height: 64px; border-radius: 8px;
    background: var(--surface2); object-fit: cover;
    border: 2px solid rgba(223,208,184,0.3);
  }
  .mc-info { flex: 1; padding-left: 14px; }
  .mc-name { font-weight: 700; font-size: 0.95rem; line-height: 1.2; }
  .mc-birth { font-size: 0.72rem; opacity: 0.7; margin-top: 4px; }
  .mc-num { font-size: 0.7rem; opacity: 0.6; margin-top: 2px; }
  .mc-body { display: flex; gap: 12px; align-items: flex-end; }
  .mc-barcode-area { text-align: center; }
  .mc-barcode-area canvas { width: 110px !important; height: 40px !important; }
  .mc-barcode-label { font-size: 0.55rem; opacity: 0.5; margin-top: 2px; }
  /* COMMISSION BADGE */
  .komisii-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
  .komisii-card {
    background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow);
    padding: 20px; text-align: center; transition: transform 0.2s;
  }
  .komisii-card:hover { transform: translateY(-4px); }
  .komisii-icon { font-size: 2.5rem; margin-bottom: 10px; }
  .komisii-name { font-weight: 700; margin-bottom: 4px; }
  .komisii-age { font-size: 0.8rem; color: var(--text2); }
  /* YOUTUBE */
  .yt-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
  .yt-card {
    background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden;
  }
  .yt-embed { width: 100%; aspect-ratio: 16/9; border: none; }
  .yt-title { padding: 12px 16px; font-weight: 600; font-size: 0.88rem; }
  /* CAMERA */
  .camera-preview {
    width: 100%; max-width: 320px; aspect-ratio: 3/4; background: #111;
    border-radius: 12px; overflow: hidden; position: relative;
    margin: 0 auto 16px;
  }
  .camera-preview video, .camera-preview img { width: 100%; height: 100%; object-fit: cover; }
  .camera-overlay {
    position: absolute; inset: 0; border: 3px solid rgba(255,255,255,0.3);
    border-radius: 12px; display: flex; align-items: center; justify-content: center;
  }
  /* MODAL */
  .modal-bg {
    display: none; position: fixed; inset: 0; z-index: 200;
    background: rgba(0,0,0,0.5); align-items: center; justify-content: center;
  }
  .modal-bg.open { display: flex; }
  .modal {
    background: var(--card); border-radius: 24px; padding: 32px;
    width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    animation: fadeIn 0.2s;
  }
  .modal-title { font-weight: 700; font-size: 1.2rem; margin-bottom: 20px; }
  .modal-close { float: right; background: none; border: none; font-size: 1.4rem; cursor: pointer; color: var(--text2); }
  /* TABS */
  .tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
  .tab {
    padding: 8px 18px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;
    cursor: pointer; border: 2px solid var(--surface2); background: transparent;
    color: var(--text2); transition: all 0.2s; font-family: 'Poppins', sans-serif;
  }
  .tab.active { background: var(--accent); border-color: var(--accent); color: var(--bg); }
  /* GKI LIST DROPDOWN */
  details summary {
    cursor: pointer; padding: 12px 16px; background: var(--surface);
    border-radius: 10px; font-weight: 600; margin-bottom: 8px;
    list-style: none; display: flex; justify-content: space-between;
  }
  details summary::after { content: 'â–¼'; font-size: 0.7rem; }
  details[open] summary::after { content: 'â–²'; }
  details .detail-body { padding: 12px 16px; font-size: 0.88rem; color: var(--text2); line-height: 1.7; }
  /* ABOUT HERO */
  .about-hero {
    background: linear-gradient(135deg, var(--surface) 0%, var(--surface2) 100%);
    border-radius: var(--radius); padding: 32px; margin-bottom: 24px; text-align: center;
  }
  .about-hero img { height: 70px; margin-bottom: 16px; }
  .about-hero h2 { font-size: 1.4rem; font-weight: 800; }
  .about-hero p { color: var(--text2); font-size: 0.88rem; max-width: 500px; margin: 8px auto 0; }
  /* FASILITAS */
  .fasilitas-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
  .fasilitas-card {
    background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow);
    padding: 20px; display: flex; gap: 14px; align-items: flex-start;
  }
  .fasilitas-icon { font-size: 2rem; }
  .fasilitas-name { font-weight: 700; margin-bottom: 4px; }
  .fasilitas-desc { font-size: 0.8rem; color: var(--text2); }
  /* NOTIFICATION */
  .notif {
    position: fixed; bottom: 20px; right: 20px;
    background: var(--accent); color: var(--bg);
    padding: 12px 20px; border-radius: 12px; font-size: 0.85rem; font-weight: 600;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2); z-index: 999;
    display: none; animation: slideUp 0.3s;
  }
  @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  /* RESPONSIVE */
  @media (max-width: 768px) {
    .sidebar { transform: translateX(-100%); }
    .sidebar.open { transform: translateX(0); }
    .content { margin-left: 0; padding: 20px; }
    .member-card-preview { width: 100%; max-width: 340px; }
  }
  /* PROFILE CHIP */
  .profile-chip {
    display: flex; align-items: center; gap: 10px;
    background: var(--surface); border-radius: 30px; padding: 6px 14px 6px 6px;
    cursor: pointer;
  }
  .profile-avatar {
    width: 32px; height: 32px; border-radius: 50%;
    background: var(--accent); display: flex; align-items: center; justify-content: center;
    color: var(--bg); font-weight: 700; font-size: 0.85rem; overflow: hidden;
  }
  .profile-name { font-size: 0.85rem; font-weight: 600; }
  .profile-komisi { font-size: 0.7rem; color: var(--text2); }
  /* HAMBURGER */
  .hamburger { display: none; }
  @media (max-width: 768px) { .hamburger { display: flex; } }
  /* INPUT FILE */
  .file-drop {
    border: 2px dashed var(--surface2); border-radius: 12px; padding: 24px;
    text-align: center; cursor: pointer; transition: border-color 0.2s;
  }
  .file-drop:hover { border-color: var(--accent); }
  .file-drop input { display: none; }
  /* TABLE */
  .table-wrap { overflow-x: auto; }
  table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
  th, td { padding: 12px 14px; text-align: left; border-bottom: 1px solid var(--surface); }
  th { font-weight: 700; color: var(--text2); }
  tr:hover td { background: var(--surface); }
  .badge {
    display: inline-block; padding: 3px 10px; border-radius: 20px;
    font-size: 0.72rem; font-weight: 700;
  }
  .badge-sm { background: var(--surface); color: var(--accent); }
  .badge-blue { background: #dbeafe; color: #1d4ed8; }
  .badge-green { background: #dcfce7; color: #166534; }
  .badge-orange { background: #fff7ed; color: #c2410c; }
  .badge-purple { background: #f3e8ff; color: #7e22ce; }
  [data-theme="dark"] .badge-blue { background: #1e3a5f; color: #93c5fd; }
  [data-theme="dark"] .badge-green { background: #14532d; color: #86efac; }
  [data-theme="dark"] .badge-orange { background: #431407; color: #fdba74; }
  [data-theme="dark"] .badge-purple { background: #3b0764; color: #d8b4fe; }
</style>
</head>
<body>

<!-- AUTH PAGES -->
<div id="authWrap" class="auth-wrap">
  <div class="auth-card">
    <div class="auth-logo">
      <img id="authLogo" src="https://upload.wikimedia.org/wikipedia/id/3/39/Gereja_Kristen_Indonesia.png" alt="GKI Logo">
    </div>

    <!-- LOGIN FORM -->
    <div id="loginForm">
      <div class="auth-title">Masuk ke GKI</div>
      <div class="auth-sub">Gereja Kristen Indonesia â€” Portal Jemaat</div>
      <div class="form-group">
        <label>Nama Lengkap</label>
        <input type="text" id="loginNama" placeholder="Masukkan nama lengkap">
      </div>
      <div class="form-group">
        <label>Nomor Anggota</label>
        <input type="text" id="loginNomor" placeholder="100DDMMYYYY">
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      <div style="text-align:right;margin-bottom:16px;">
        <a href="#" onclick="showForgot()" style="font-size:0.82rem;color:var(--accent);text-decoration:none;font-weight:600;">Lupa Password?</a>
      </div>
      <button class="btn btn-primary btn-block" onclick="doLogin()">Masuk</button>
      <div class="auth-link">Belum punya akun? <a href="#" onclick="showRegister()">Daftar</a></div>
    </div>

    <!-- REGISTER FORM -->
    <div id="registerForm" style="display:none;">
      <div class="auth-title">Daftar Anggota Baru</div>
      <div class="auth-sub">Lengkapi data diri Anda untuk bergabung</div>
      <div class="form-group">
        <label>Nama Lengkap</label>
        <input type="text" id="regNama" placeholder="Nama sesuai KTP">
      </div>
      <div class="form-group">
        <label>Nomor KTP</label>
        <input type="text" id="regKTP" placeholder="16 digit NIK">
      </div>
      <div class="form-group">
        <label>Tempat Lahir</label>
        <input type="text" id="regTempatLahir" placeholder="Kota/Kabupaten">
      </div>
      <div class="form-group">
        <label>Tanggal Lahir</label>
        <input type="date" id="regTanggalLahir">
      </div>
      <div class="form-group">
        <label>Upload Foto KK (salah satu anggota)</label>
        <div class="file-drop" onclick="document.getElementById('kkUpload').click()">
          <div id="kkLabel">ğŸ“‚ Klik untuk upload Kartu Keluarga</div>
          <input type="file" id="kkUpload" accept="image/*" onchange="previewKK(this)">
        </div>
      </div>
      <div class="form-group">
        <label>Foto Profil (dari kamera atau file)</label>
        <div style="display:flex;gap:8px;margin-bottom:8px;">
          <button class="btn btn-outline btn-sm" onclick="openCamera('reg')">ğŸ“· Buka Kamera</button>
          <button class="btn btn-outline btn-sm" onclick="document.getElementById('photoUpload').click()">ğŸ–¼ Upload Foto</button>
        </div>
        <input type="file" id="photoUpload" accept="image/*" style="display:none" onchange="previewPhoto(this)">
        <canvas id="regPhotoCanvas" style="display:none;border-radius:8px;width:80px;height:100px;object-fit:cover;"></canvas>
        <img id="regPhotoPreview" style="display:none;border-radius:8px;width:80px;height:100px;object-fit:cover;">
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="regPass" placeholder="Minimal 8 karakter">
      </div>
      <div class="form-group">
        <label>Konfirmasi Password</label>
        <input type="password" id="regPass2" placeholder="Ulangi password">
      </div>
      <button class="btn btn-primary btn-block" onclick="doRegister()">Daftar Sekarang</button>
      <div class="auth-link">Sudah punya akun? <a href="#" onclick="showLogin()">Masuk</a></div>
    </div>

    <!-- FORGOT PASSWORD -->
    <div id="forgotForm" style="display:none;">
      <div class="auth-title">Lupa Password</div>
      <div class="auth-sub">Masukkan nama dan nomor KTP Anda</div>
      <div class="form-group">
        <label>Nama Lengkap</label>
        <input type="text" placeholder="Nama sesuai KTP">
      </div>
      <div class="form-group">
        <label>Nomor KTP</label>
        <input type="text" placeholder="16 digit NIK">
      </div>
      <button class="btn btn-primary btn-block" onclick="showNotif('Link reset password telah dikirim ke admin gereja.')">Kirim Permintaan</button>
      <div class="auth-link"><a href="#" onclick="showLogin()">â† Kembali ke Login</a></div>
    </div>
  </div>
</div>

<!-- MAIN APP -->
<div id="appWrap" style="display:none;">

  <!-- NAVBAR -->
  <nav class="navbar">
    <div style="display:flex;align-items:center;gap:12px;">
      <button class="btn-icon hamburger" id="hamburgerBtn" onclick="toggleSidebar()">â˜°</button>
      <div class="nav-logo">
        <img src="https://upload.wikimedia.org/wikipedia/id/3/39/Gereja_Kristen_Indonesia.png" alt="GKI" id="navLogo">
        <span>GKI Portal</span>
      </div>
    </div>
    <div class="nav-actions">
      <button class="btn-icon" onclick="toggleTheme()" id="themeBtn" title="Toggle Dark/Light Mode">ğŸŒ™</button>
      <div class="profile-chip" onclick="navigate('akun')">
        <div class="profile-avatar" id="navAvatar">J</div>
        <div>
          <div class="profile-name" id="navName">Jemaat</div>
          <div class="profile-komisi" id="navKomisi">Komisi Dewasa</div>
        </div>
      </div>
    </div>
  </nav>

  <div class="main-wrap">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <ul class="sidebar-nav">
        <div class="sidebar-section">Menu Utama</div>
        <li><a href="#" onclick="navigate('dashboard')" id="nav-dashboard" class="active"><span class="icon">ğŸ </span> Dashboard</a></li>
        <li><a href="#" onclick="navigate('jadwal')" id="nav-jadwal"><span class="icon">ğŸ“…</span> Jadwal Ibadah</a></li>
        <li><a href="#" onclick="navigate('komisi')" id="nav-komisi"><span class="icon">ğŸ‘¥</span> Komisi</a></li>
        <li><a href="#" onclick="navigate('materi')" id="nav-materi"><span class="icon">ğŸ“–</span> Materi & Renungan</a></li>
        <div class="sidebar-section">Anggota</div>
        <li><a href="#" onclick="navigate('kartu')" id="nav-kartu"><span class="icon">ğŸªª</span> Kartu Jemaat</a></li>
        <li><a href="#" onclick="navigate('barcode')" id="nav-barcode"><span class="icon">â–¦</span> Barcode Saya</a></li>
        <li><a href="#" onclick="navigate('akun')" id="nav-akun"><span class="icon">ğŸ‘¤</span> Akun</a></li>
        <div class="sidebar-section">Gereja</div>
        <li><a href="#" onclick="navigate('tentang')" id="nav-tentang"><span class="icon">â„¹ï¸</span> Tentang GKI</a></li>
        <li><a href="#" onclick="navigate('fasilitas')" id="nav-fasilitas"><span class="icon">ğŸ›</span> Fasilitas</a></li>
        <div class="sidebar-section">Admin</div>
        <li><a href="#" onclick="navigate('daftar-jemaat')" id="nav-daftar-jemaat"><span class="icon">ğŸ“‹</span> Data Jemaat</a></li>
        <li><a href="#" onclick="doLogout()" style="color:#e74c3c;"><span class="icon">ğŸšª</span> Keluar</a></li>
      </ul>
    </aside>

    <!-- CONTENT -->
    <main class="content">

      <!-- DASHBOARD -->
      <div class="page active" id="page-dashboard">
        <div class="greeting" id="greetingText">Selamat Datang! ğŸ‘‹</div>
        <div class="greeting-sub" id="greetingDate"></div>
        <div class="grid-3">
          <div class="stat-card">
            <div class="stat-icon">â›ª</div>
            <div class="stat-label">Status Anggota</div>
            <div class="stat-val" style="font-size:1rem;" id="dashKomisi">Komisi Dewasa</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ğŸ”¢</div>
            <div class="stat-label">Nomor Jemaat</div>
            <div class="stat-val" style="font-size:1rem;" id="dashNomor">â€”</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ğŸ“…</div>
            <div class="stat-label">Ibadah Berikutnya</div>
            <div class="stat-val" style="font-size:0.9rem;" id="dashIbadah">Minggu, 07.00 WIB</div>
          </div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ“¢ Pengumuman Gereja</div>
          <div style="display:flex;flex-direction:column;gap:12px;">
            <div style="background:var(--surface);border-radius:10px;padding:14px;">
              <div style="font-weight:600;font-size:0.9rem;">ğŸ‰ Ibadah Minggu Pagi</div>
              <div style="font-size:0.8rem;color:var(--text2);margin-top:4px;">Hadir tepat waktu, pukul 07.00 & 10.00 WIB. Dress code: formal.</div>
            </div>
            <div style="background:var(--surface);border-radius:10px;padding:14px;">
              <div style="font-weight:600;font-size:0.9rem;">ğŸ“– Sekolah Minggu</div>
              <div style="font-size:0.8rem;color:var(--text2);margin-top:4px;">Kelas berlangsung bersamaan dengan ibadah 10.00 WIB. Ruang B1.</div>
            </div>
            <div style="background:var(--surface);border-radius:10px;padding:14px;">
              <div style="font-weight:600;font-size:0.9rem;">âœï¸ Ibadah Sore</div>
              <div style="font-size:0.8rem;color:var(--text2);margin-top:4px;">Setiap Minggu pukul 17.00 WIB. Cocok untuk keluarga muda.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- JADWAL IBADAH -->
      <div class="page" id="page-jadwal">
        <h2 style="font-weight:800;font-size:1.4rem;margin-bottom:24px;">ğŸ“… Jadwal Ibadah</h2>
        <div class="grid-3">
          <div class="card">
            <div class="card-title">â›ª Jadwal Mingguan</div>
            <div class="ibadah-list">
              <div class="ibadah-item">
                <div>
                  <div class="ibadah-time">07.00 WIB</div>
                  <div class="ibadah-label">Ibadah Pagi I â€” Minggu</div>
                </div>
                <div class="countdown-badge" id="cd1">â€”</div>
              </div>
              <div class="ibadah-item">
                <div>
                  <div class="ibadah-time">10.00 WIB</div>
                  <div class="ibadah-label">Ibadah Pagi II â€” Minggu</div>
                </div>
                <div class="countdown-badge" id="cd2">â€”</div>
              </div>
              <div class="ibadah-item">
                <div>
                  <div class="ibadah-time">17.00 WIB</div>
                  <div class="ibadah-label">Ibadah Sore â€” Minggu</div>
                </div>
                <div class="countdown-badge" id="cd3">â€”</div>
              </div>
            </div>
          </div>
          <div class="card" style="grid-column: span 2;">
            <div class="card-title">ğŸ—“ Kalender <span id="calMonthLabel"></span></div>
            <div class="cal-grid" id="calGrid"></div>
            <div style="margin-top:12px;font-size:0.78rem;color:var(--text2);">
              <span style="display:inline-block;width:12px;height:12px;background:var(--accent);border-radius:3px;margin-right:4px;"></span>Hari Ini &nbsp;
              <span style="display:inline-block;width:12px;height:12px;background:var(--surface);border-radius:3px;margin-right:4px;"></span>Hari Ibadah (Minggu)
            </div>
          </div>
        </div>
      </div>

      <!-- KOMISI -->
      <div class="page" id="page-komisi">
        <h2 style="font-weight:800;font-size:1.4rem;margin-bottom:24px;">ğŸ‘¥ Kategori Komisi</h2>
        <div class="komisii-grid">
          <div class="komisii-card">
            <div class="komisii-icon">ğŸ§’</div>
            <div class="komisii-name">Sekolah Minggu</div>
            <div class="komisii-age">Usia: 0 â€“ 12 tahun</div>
            <div style="font-size:0.78rem;color:var(--text2);margin-top:8px;">Kelas ibadah anak-anak dengan pengajaran Alkitab yang menyenangkan.</div>
          </div>
          <div class="komisii-card">
            <div class="komisii-icon">ğŸ§‘</div>
            <div class="komisii-name">Komisi Remaja</div>
            <div class="komisii-age">Usia: 13 â€“ 25 tahun</div>
            <div style="font-size:0.78rem;color:var(--text2);margin-top:8px;">Persekutuan pemuda yang aktif, kreatif, dan dinamis dalam iman.</div>
          </div>
          <div class="komisii-card">
            <div class="komisii-icon">ğŸ§‘â€ğŸ’¼</div>
            <div class="komisii-name">Komisi Dewasa</div>
            <div class="komisii-age">Usia: 26 â€“ 59 tahun</div>
            <div style="font-size:0.78rem;color:var(--text2);margin-top:8px;">Jemaat usia produktif dengan berbagai program pembinaan dan pelayanan.</div>
          </div>
          <div class="komisii-card">
            <div class="komisii-icon">ğŸ‘´</div>
            <div class="komisii-name">Komisi Lansia</div>
            <div class="komisii-age">Usia: 60 tahun ke atas</div>
            <div style="font-size:0.78rem;color:var(--text2);margin-top:8px;">Pelayanan kasih bagi para sesepuh gereja dengan pendampingan spiritual.</div>
          </div>
        </div>
        <div class="card" style="margin-top:24px;">
          <div class="card-title">ğŸ” Cek Kategori Komisi Anda</div>
          <div style="display:flex;gap:12px;align-items:flex-end;flex-wrap:wrap;">
            <div class="form-group" style="margin:0;flex:1;min-width:200px;">
              <label>Tanggal Lahir Anda</label>
              <input type="date" id="checkDOB">
            </div>
            <button class="btn btn-primary" onclick="checkKomisi()">Cek Komisi</button>
          </div>
          <div id="komisiResult" style="margin-top:16px;display:none;background:var(--surface);border-radius:10px;padding:14px;"></div>
        </div>
      </div>

      <!-- MATERI & RENUNGAN -->
      <div class="page" id="page-materi">
        <h2 style="font-weight:800;font-size:1.4rem;margin-bottom:24px;">ğŸ“– Materi & Renungan</h2>
        <div class="tabs">
          <button class="tab active" onclick="showTab('tabYt','ytContent')">ğŸ¬ YouTube GKI</button>
          <button class="tab" onclick="showTab('tabRen','renContent')">âœï¸ Renungan Harian</button>
          <button class="tab" onclick="showTab('tabSer','serContent')">ğŸ“„ Seri Khotbah</button>
        </div>
        <div id="ytContent">
          <div class="yt-grid">
            <div class="yt-card">
              <iframe class="yt-embed" src="https://www.youtube.com/embed/?listType=user_uploads&list=GKI_Indonesia" allowfullscreen></iframe>
              <div class="yt-title">Ibadah Minggu â€” GKI Live</div>
            </div>
            <div class="yt-card">
              <iframe class="yt-embed" src="https://www.youtube.com/embed/videoseries?list=PLrMDEQWQXBQlAdFVsq3hfEsrVoJTCkVjj" allowfullscreen></iframe>
              <div class="yt-title">Renungan & Khotbah GKI</div>
            </div>
            <div class="yt-card">
              <iframe class="yt-embed" src="https://www.youtube.com/embed/dKCJA3b_T3s" allowfullscreen></iframe>
              <div class="yt-title">Ibadah GKI Terbaru</div>
            </div>
          </div>
          <div style="text-align:center;margin-top:20px;">
            <a href="https://www.youtube.com/@GKI_Indonesia" target="_blank" class="btn btn-outline">
              â–¶ Buka Channel YouTube GKI
            </a>
          </div>
        </div>
        <div id="renContent" style="display:none;">
          <div class="card">
            <div class="card-title">âœï¸ Renungan Hari Ini</div>
            <div style="font-style:italic;font-size:0.88rem;color:var(--text2);margin-bottom:12px;" id="renDate"></div>
            <blockquote style="border-left:4px solid var(--accent);padding-left:16px;margin-bottom:12px;font-style:italic;">
              "Tuhan adalah gembalaku, takkan kekurangan aku." â€” Mazmur 23:1
            </blockquote>
            <p style="font-size:0.88rem;line-height:1.8;color:var(--text2);">
              Seperti gembala yang merawat domba-dombanya dengan penuh kasih, demikianlah Tuhan merawat dan memimpin hidup kita. Ia menuntun kita ke padang rumput yang hijau dan air yang tenang. Dalam setiap kekhawatiran dan ketakutan, ingatlah bahwa kita tidak berjalan sendirian.
            </p>
          </div>
        </div>
        <div id="serContent" style="display:none;">
          <div style="display:flex;flex-direction:column;gap:12px;">
            <div class="card" style="margin:0;">
              <div style="font-weight:700;">Seri 1: Kasih yang Nyata</div>
              <div style="font-size:0.8rem;color:var(--text2);">6 sesi Â· Pengkhotbah: Pdt. Andi Santoso</div>
            </div>
            <div class="card" style="margin:0;">
              <div style="font-weight:700;">Seri 2: Iman di Tengah Badai</div>
              <div style="font-size:0.8rem;color:var(--text2);">4 sesi Â· Pengkhotbah: Pdt. Maria Wijaya</div>
            </div>
            <div class="card" style="margin:0;">
              <div style="font-weight:700;">Seri 3: Keluarga yang Diberkati</div>
              <div style="font-size:0.8rem;color:var(--text2);">8 sesi Â· Pengkhotbah: Pdt. Budi Hartono</div>
            </div>
          </div>
        </div>
      </div>

      <!-- KARTU JEMAAT -->
      <div class="page" id="page-kartu">
        <h2 style="font-weight:800;font-size:1.4rem;margin-bottom:24px;">ğŸªª Kartu Jemaat</h2>
        <div style="display:flex;gap:24px;flex-wrap:wrap;align-items:flex-start;">
          <div>
            <div class="member-card-preview" id="memberCardEl">
              <div class="mc-header">
                <div class="mc-logo">GKI â€” GEREJA KRISTEN INDONESIA</div>
                <div class="mc-komisii" id="mcKomisi">Komisi Dewasa</div>
              </div>
              <div class="mc-body">
                <img class="mc-photo" id="mcPhoto" src="" alt="Foto">
                <div class="mc-info">
                  <div class="mc-name" id="mcName">Nama Lengkap</div>
                  <div class="mc-birth" id="mcBirth">ğŸ“ Kota Lahir / 01-01-1990</div>
                  <div class="mc-num" id="mcNum">No. Jemaat: â€”</div>
                  <div class="mc-barcode-area" style="margin-top:10px;">
                    <canvas id="mcBarcode"></canvas>
                    <div class="mc-barcode-label" id="mcBarcodeLabel">â€”</div>
                  </div>
                </div>
              </div>
            </div>
            <div style="margin-top:14px;display:flex;gap:8px;">
              <button class="btn btn-primary btn-sm" onclick="downloadCard()">â¬‡ Download Kartu</button>
              <button class="btn btn-outline btn-sm" onclick="printCard()">ğŸ–¨ Cetak</button>
            </div>
          </div>
          <div style="flex:1;min-width:250px;">
            <div class="card">
              <div class="card-title">Data pada Kartu</div>
              <div style="display:flex;flex-direction:column;gap:8px;font-size:0.85rem;">
                <div style="display:flex;justify-content:space-between;"><span style="color:var(--text2);">Nama</span><strong id="infoNama">â€”</strong></div>
                <div style="display:flex;justify-content:space-between;"><span style="color:var(--text2);">Tempat/Tgl Lahir</span><strong id="infoBirth">â€”</strong></div>
                <div style="display:flex;justify-content:space-between;"><span style="color:var(--text2);">No. Jemaat</span><strong id="infoNomor">â€”</strong></div>
                <div style="display:flex;justify-content:space-between;"><span style="color:var(--text2);">Komisi</span><strong id="infoKomisi">â€”</strong></div>
                <div style="display:flex;justify-content:space-between;"><span style="color:var(--text2);">Tgl Bergabung</span><strong id="infoGabung">â€”</strong></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- BARCODE -->
      <div class="page" id="page-barcode">
        <h2 style="font-weight:800;font-size:1.4rem;margin-bottom:24px;">â–¦ Barcode Jemaat</h2>
        <div class="card" style="text-align:center;max-width:400px;">
          <div class="card-title">Barcode Anggota Anda</div>
          <div style="background:#fff;border-radius:12px;padding:20px;display:inline-block;margin-bottom:12px;">
            <canvas id="barcodeCanvas"></canvas>
          </div>
          <div style="font-size:0.85rem;color:var(--text2);margin-bottom:4px;" id="bcNomor">â€”</div>
          <div style="font-size:0.75rem;color:var(--muted);">Barcode Code 128 â€¢ Tunjukkan ke petugas gereja</div>
          <div style="margin-top:16px;">
            <button class="btn btn-primary btn-sm" onclick="downloadBarcode()">â¬‡ Download Barcode</button>
          </div>
        </div>
        <div class="card" style="margin-top:24px;max-width:400px;">
          <div class="card-title">â„¹ï¸ Informasi Barcode</div>
          <div style="display:flex;flex-direction:column;gap:8px;font-size:0.83rem;">
            <div><span style="color:var(--text2);">Nomor Anggota:</span> <strong id="bcInfo1">â€”</strong></div>
            <div><span style="color:var(--text2);">Nomor KTP:</span> <strong id="bcInfo2">â€”</strong></div>
            <div><span style="color:var(--text2);">Kategori Komisi:</span> <strong id="bcInfo3">â€”</strong></div>
            <div><span style="color:var(--text2);">Tanggal Bergabung:</span> <strong id="bcInfo4">â€”</strong></div>
          </div>
        </div>
      </div>

      <!-- AKUN -->
      <div class="page" id="page-akun">
        <h2 style="font-weight:800;font-size:1.4rem;margin-bottom:24px;">ğŸ‘¤ Profil Akun</h2>
        <div style="display:flex;gap:24px;flex-wrap:wrap;">
          <div class="card" style="min-width:260px;text-align:center;">
            <div style="width:80px;height:100px;border-radius:10px;background:var(--surface);margin:0 auto 12px;overflow:hidden;">
              <img id="profilePhoto" src="" alt="" style="width:100%;height:100%;object-fit:cover;display:none;">
              <div id="profilePhotoPlaceholder" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:2.5rem;">ğŸ‘¤</div>
            </div>
            <div style="font-weight:700;font-size:1.1rem;" id="profileName">â€”</div>
            <div style="font-size:0.8rem;color:var(--text2);" id="profileKomisi">â€”</div>
            <div style="margin-top:12px;"><span class="badge badge-green" id="profileStatus">Anggota Aktif</span></div>
          </div>
          <div class="card" style="flex:1;">
            <div class="card-title">Data Pribadi</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:0.85rem;">
              <div><div style="color:var(--text2);margin-bottom:2px;">Nomor Anggota</div><strong id="pd1">â€”</strong></div>
              <div><div style="color:var(--text2);margin-bottom:2px;">Nomor KTP</div><strong id="pd2">â€”</strong></div>
              <div><div style="color:var(--text2);margin-bottom:2px;">Tempat Lahir</div><strong id="pd3">â€”</strong></div>
              <div><div style="color:var(--text2);margin-bottom:2px;">Tanggal Lahir</div><strong id="pd4">â€”</strong></div>
              <div><div style="color:var(--text2);margin-bottom:2px;">Tanggal Bergabung</div><strong id="pd5">â€”</strong></div>
              <div><div style="color:var(--text2);margin-bottom:2px;">Komisi</div><strong id="pd6">â€”</strong></div>
            </div>
            <button class="btn btn-outline btn-sm" style="margin-top:16px;" onclick="showNotif('Fitur edit profil akan segera tersedia.')">âœï¸ Edit Profil</button>
          </div>
        </div>
        <div class="card" style="margin-top:0;">
          <div class="card-title">âš™ï¸ Pengaturan</div>
          <div style="display:flex;flex-direction:column;gap:12px;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div>
                <div style="font-weight:600;font-size:0.9rem;">Mode Tampilan</div>
                <div style="font-size:0.78rem;color:var(--text2);">Gelap / Terang</div>
              </div>
              <button class="btn btn-outline btn-sm" onclick="toggleTheme()" id="themeToggleBtn">ğŸŒ™ Dark Mode</button>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div>
                <div style="font-weight:600;font-size:0.9rem;">Ubah Password</div>
                <div style="font-size:0.78rem;color:var(--text2);">Ganti password akun</div>
              </div>
              <button class="btn btn-outline btn-sm" onclick="showNotif('Fitur ubah password akan segera tersedia.')">ğŸ”’ Ubah</button>
            </div>
          </div>
        </div>
      </div>

      <!-- TENTANG -->
      <div class="page" id="page-tentang">
        <div class="about-hero">
          <img src="https://upload.wikimedia.org/wikipedia/id/3/39/Gereja_Kristen_Indonesia.png" alt="GKI" id="aboutLogo">
          <h2>Gereja Kristen Indonesia (GKI)</h2>
          <p>GKI adalah gereja protestan di Indonesia yang berdiri pada 26 Oktober 1958 melalui penggabungan beberapa gereja Calvinis reformasi di Indonesia.</p>
        </div>
        <div class="card">
          <div class="card-title">GKI di Seluruh Indonesia</div>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <details>
              <summary>GKI Jawa Tengah</summary>
              <div class="detail-body">GKI Jawa Tengah berpusat di Semarang dan melayani jemaat di wilayah Jawa Tengah. Memiliki ratusan jemaat lokal di berbagai kota dengan program pelayanan yang beragam.</div>
            </details>
            <details>
              <summary>GKI Jawa Barat</summary>
              <div class="detail-body">GKI Jawa Barat berpusat di Bandung, melayani jemaat di wilayah Jawa Barat dan sekitarnya. Dikenal aktif dalam pelayanan sosial dan pendidikan Kristiani.</div>
            </details>
            <details>
              <summary>GKI Jawa Timur</summary>
              <div class="detail-body">GKI Jawa Timur berpusat di Surabaya, melayani jemaat di Jawa Timur. Memiliki berbagai program pembinaan keluarga dan pemuda yang aktif.</div>
            </details>
            <details>
              <summary>GKI Jakarta & Banten</summary>
              <div class="detail-body">GKI di wilayah Jabodetabek dan Banten, dengan banyak jemaat lokal di berbagai penjuru ibukota dan sekitarnya. Aktif dalam pelayanan perkotaan dan komunitas.</div>
            </details>
            <details>
              <summary>GKI Kalimantan</summary>
              <div class="detail-body">Melayani jemaat di Kalimantan dengan program misi dan pengembangan jemaat yang menyesuaikan kebudayaan lokal.</div>
            </details>
            <details>
              <summary>GKI Sulawesi</summary>
              <div class="detail-body">Melayani jemaat di Sulawesi dengan berbagai program pelayanan dan pengembangan gereja yang berfokus pada kekeluargaan dan kebersamaan.</div>
            </details>
          </div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ¯ Visi & Misi</div>
          <p style="font-size:0.88rem;line-height:1.8;color:var(--text2);">
            <strong>Visi:</strong> Menjadi gereja yang semakin serupa dengan Kristus â€” dalam kasih, kebenaran, dan pelayanan.<br><br>
            <strong>Misi:</strong> Memberitakan Injil, membina warga gereja, dan melayani masyarakat luas demi kemuliaan Tuhan.
          </p>
        </div>
      </div>

      <!-- FASILITAS -->
      <div class="page" id="page-fasilitas">
        <h2 style="font-weight:800;font-size:1.4rem;margin-bottom:24px;">ğŸ› Fasilitas Gereja</h2>
        <div class="fasilitas-grid">
          <div class="fasilitas-card"><div class="fasilitas-icon">â›ª</div><div><div class="fasilitas-name">Ruang Ibadah Utama</div><div class="fasilitas-desc">Berkapasitas Â±500 orang dengan tata suara dan pencahayaan modern.</div></div></div>
          <div class="fasilitas-card"><div class="fasilitas-icon">ğŸ§’</div><div><div class="fasilitas-name">Ruang Sekolah Minggu</div><div class="fasilitas-desc">Ruang khusus anak-anak yang nyaman dan penuh warna, tersedia di B1 & B2.</div></div></div>
          <div class="fasilitas-card"><div class="fasilitas-icon">ğŸ“š</div><div><div class="fasilitas-name">Perpustakaan</div><div class="fasilitas-desc">Koleksi buku rohani, Alkitab berbagai versi, dan bahan studi Kristen.</div></div></div>
          <div class="fasilitas-card"><div class="fasilitas-icon">ğŸ½</div><div><div class="fasilitas-name">Dapur & Aula Makan</div><div class="fasilitas-desc">Tersedia untuk fellowship dan acara gereja dengan kapasitas 150 orang.</div></div></div>
          <div class="fasilitas-card"><div class="fasilitas-icon">ğŸ…¿</div><div><div class="fasilitas-name">Area Parkir</div><div class="fasilitas-desc">Parkir luas untuk Â±200 kendaraan roda empat dan motor.</div></div></div>
          <div class="fasilitas-card"><div class="fasilitas-icon">ğŸµ</div><div><div class="fasilitas-name">Ruang Musik</div><div class="fasilitas-desc">Studio latihan tim pujian dan worship yang dilengkapi instrumen lengkap.</div></div></div>
          <div class="fasilitas-card"><div class="fasilitas-icon">ğŸ’»</div><div><div class="fasilitas-name">Ruang Multimedia</div><div class="fasilitas-desc">Ruang kontrol streaming ibadah dengan peralatan broadcast profesional.</div></div></div>
          <div class="fasilitas-card"><div class="fasilitas-icon">ğŸŒ¿</div><div><div class="fasilitas-name">Taman Rohani</div><div class="fasilitas-desc">Area outdoor untuk retreat, doa, dan persekutuan kecil di alam terbuka.</div></div></div>
        </div>
        <div class="card" style="margin-top:0;">
          <div class="card-title">ğŸ“ Lokasi Gereja</div>
          <p style="font-size:0.88rem;color:var(--text2);line-height:1.7;">
            Jl. Contoh No. 1, Kota, Provinsi, Indonesia<br>
            ğŸ“ (021) 123-4567 &nbsp;|&nbsp; ğŸ“§ <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1b72757d745b7c707235746935727f">[email&#160;protected]</a><br>
            ğŸ• Kantor Tata Usaha: Seninâ€“Jumat 08.00â€“17.00 WIB
          </p>
        </div>
      </div>

      <!-- DATA JEMAAT (ADMIN) -->
      <div class="page" id="page-daftar-jemaat">
        <h2 style="font-weight:800;font-size:1.4rem;margin-bottom:24px;">ğŸ“‹ Data Jemaat</h2>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:8px;">
            <div class="card-title" style="margin:0;">Daftar Anggota Terdaftar</div>
            <div style="display:flex;gap:8px;">
              <input type="text" placeholder="Cari nama..." style="padding:8px 12px;border-radius:8px;border:2px solid var(--surface2);background:var(--surface);color:var(--text);font-family:'Poppins',sans-serif;font-size:0.82rem;" oninput="filterJemaat(this.value)">
            </div>
          </div>
          <div class="table-wrap">
            <table id="jemaatTable">
              <thead>
                <tr>
                  <th>No</th>
                  <th>Nama</th>
                  <th>No. Anggota</th>
                  <th>Komisi</th>
                  <th>Tgl Bergabung</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="jemaatBody"></tbody>
            </table>
          </div>
        </div>
      </div>

    </main>
  </div>
</div>

<!-- CAMERA MODAL -->
<div class="modal-bg" id="cameraModal">
  <div class="modal" style="max-width:400px;text-align:center;">
    <button class="modal-close" onclick="closeCamera()">âœ•</button>
    <div class="modal-title">ğŸ“· Ambil Foto</div>
    <div class="camera-preview">
      <video id="camVideo" autoplay playsinline style="width:100%;height:100%;object-fit:cover;"></video>
      <div class="camera-overlay"></div>
    </div>
    <button class="btn btn-primary" onclick="capturePhoto()">ğŸ“¸ Ambil Foto</button>
    <canvas id="captureCanvas" style="display:none;"></canvas>
  </div>
</div>

<!-- DETAIL MEMBER MODAL -->
<div class="modal-bg" id="detailModal">
  <div class="modal" style="max-width:420px;">
    <button class="modal-close" onclick="closeDetailModal()">âœ•</button>
    <div class="modal-title">ğŸ‘¤ Detail Anggota</div>
    <div id="detailContent"></div>
  </div>
</div>

<!-- CONFIRM DELETE MODAL -->
<div class="modal-bg" id="confirmModal">
  <div class="modal" style="max-width:380px;text-align:center;">
    <div style="font-size:2.5rem;margin-bottom:12px;">âš ï¸</div>
    <div class="modal-title" style="text-align:center;">Konfirmasi Hapus</div>
    <p id="confirmMsg" style="font-size:0.88rem;color:var(--text2);margin-bottom:24px;line-height:1.6;"></p>
    <div style="display:flex;gap:10px;justify-content:center;">
      <button class="btn btn-outline" onclick="closeConfirmModal()">Batal</button>
      <button class="btn" id="confirmYes" style="background:#dc2626;color:#fff;border:none;">ğŸ—‘ Ya, Hapus</button>
    </div>
  </div>
</div>

<!-- NOTIFICATION -->
<div class="notif" id="notif"></div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// ==================== UTILS (defined first) ====================
function generateNomorAnggota(tglLahir) {
  const d = new Date(tglLahir);
  const dd = String(d.getDate()).padStart(2, '0');
  const mm = String(d.getMonth() + 1).padStart(2, '0');
  const yyyy = d.getFullYear();
  return `100${dd}${mm}${yyyy}`;
}

function getKomisiFromDOB(tglLahir) {
  const dob = new Date(tglLahir);
  const today = new Date();
  let age = today.getFullYear() - dob.getFullYear();
  const m = today.getMonth() - dob.getMonth();
  if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) age--;
  if (age <= 12) return 'Sekolah Minggu';
  if (age <= 25) return 'Komisi Remaja';
  if (age <= 59) return 'Komisi Dewasa';
  return 'Komisi Lansia';
}

// Pastikan demo member selalu ada dengan data yang benar
function ensureDemoMember() {
  let members = JSON.parse(localStorage.getItem('gki_members') || '[]');
  const demoExists = members.find(m => m.ktp === '3201012501900001');
  if (!demoExists) {
    const demo = {
      nama: 'Demo Jemaat',
      ktp: '3201012501900001',
      tempat: 'Jakarta',
      tglLahir: '1990-01-25',
      password: 'demo1234',
      nomorAnggota: generateNomorAnggota('1990-01-25'),
      komisi: 'Komisi Dewasa',
      tglBergabung: new Date().toISOString().split('T')[0],
      foto: ''
    };
    members.push(demo);
    localStorage.setItem('gki_members', JSON.stringify(members));
  }
  return JSON.parse(localStorage.getItem('gki_members'));
}

// ==================== STATE ====================
let appState = {
  user: null,
  members: ensureDemoMember(),
  theme: localStorage.getItem('gki_theme') || 'light',
  cameraTarget: null,
  stream: null
};

// ==================== INIT ====================
document.addEventListener('DOMContentLoaded', () => {
  applyTheme(appState.theme);
  updateGreeting();
  updateCalendar();
  updateCountdowns();
  setInterval(updateCountdowns, 60000);
  setInterval(updateGreeting, 60000);
  populateJemaatTable();

  const saved = localStorage.getItem('gki_session');
  if (saved) {
    appState.user = JSON.parse(saved);
    enterApp();
  }
});

// ==================== AUTH ====================
function showLogin() {
  document.getElementById('loginForm').style.display = 'block';
  document.getElementById('registerForm').style.display = 'none';
  document.getElementById('forgotForm').style.display = 'none';
}
function showRegister() {
  document.getElementById('loginForm').style.display = 'none';
  document.getElementById('registerForm').style.display = 'block';
  document.getElementById('forgotForm').style.display = 'none';
}
function showForgot() {
  document.getElementById('loginForm').style.display = 'none';
  document.getElementById('registerForm').style.display = 'none';
  document.getElementById('forgotForm').style.display = 'block';
}

function doLogin() {
  const nama = document.getElementById('loginNama').value.trim();
  const nomor = document.getElementById('loginNomor').value.trim();
  const pass = document.getElementById('loginPass').value;
  if (!nama || !nomor || !pass) { showNotif('Lengkapi semua field!'); return; }

  const member = appState.members.find(m =>
    m.nama.toLowerCase() === nama.toLowerCase() &&
    m.nomorAnggota === nomor &&
    m.password === pass
  );
  if (!member) { showNotif('Data tidak cocok. Periksa kembali!'); return; }

  appState.user = member;
  localStorage.setItem('gki_session', JSON.stringify(member));
  enterApp();
}

let capturedPhotoData = null;

function doRegister() {
  const nama = document.getElementById('regNama').value.trim();
  const ktp = document.getElementById('regKTP').value.trim();
  const tempat = document.getElementById('regTempatLahir').value.trim();
  const tgl = document.getElementById('regTanggalLahir').value;
  const pass = document.getElementById('regPass').value;
  const pass2 = document.getElementById('regPass2').value;

  if (!nama || !ktp || !tempat || !tgl || !pass) { showNotif('Lengkapi semua field!'); return; }
  if (pass !== pass2) { showNotif('Password tidak sama!'); return; }
  if (pass.length < 8) { showNotif('Password minimal 8 karakter!'); return; }
  if (ktp.length !== 16) { showNotif('Nomor KTP harus 16 digit!'); return; }

  const nomorAnggota = generateNomorAnggota(tgl);
  const komisi = getKomisiFromDOB(tgl);
  const today = new Date().toISOString().split('T')[0];

  const member = {
    nama, ktp, tempat, tglLahir: tgl,
    password: pass, nomorAnggota, komisi,
    tglBergabung: today,
    foto: capturedPhotoData || ''
  };

  appState.members.push(member);
  localStorage.setItem('gki_members', JSON.stringify(appState.members));
  appState.user = member;
  localStorage.setItem('gki_session', JSON.stringify(member));
  capturedPhotoData = null;
  showNotif(`Selamat datang, ${nama}! Nomor anggota: ${nomorAnggota}`);
  setTimeout(enterApp, 1000);
}

function doLogout() {
  localStorage.removeItem('gki_session');
  appState.user = null;
  document.getElementById('appWrap').style.display = 'none';
  document.getElementById('authWrap').style.display = 'flex';
  showLogin();
}

function enterApp() {
  document.getElementById('authWrap').style.display = 'none';
  document.getElementById('appWrap').style.display = 'block';
  populateUserData();
  navigate('dashboard');
  populateJemaatTable();
}

function populateUserData() {
  const u = appState.user;
  if (!u) return;

  // Nav
  document.getElementById('navName').textContent = u.nama.split(' ')[0];
  document.getElementById('navKomisi').textContent = u.komisi;
  document.getElementById('navAvatar').textContent = u.nama[0].toUpperCase();

  // Dashboard
  document.getElementById('dashKomisi').textContent = u.komisi;
  document.getElementById('dashNomor').textContent = u.nomorAnggota;

  // Profile page
  document.getElementById('profileName').textContent = u.nama;
  document.getElementById('profileKomisi').textContent = u.komisi;
  document.getElementById('pd1').textContent = u.nomorAnggota;
  document.getElementById('pd2').textContent = u.ktp;
  document.getElementById('pd3').textContent = u.tempat;
  document.getElementById('pd4').textContent = formatDate(u.tglLahir);
  document.getElementById('pd5').textContent = formatDate(u.tglBergabung);
  document.getElementById('pd6').textContent = u.komisi;

  if (u.foto) {
    document.getElementById('profilePhoto').src = u.foto;
    document.getElementById('profilePhoto').style.display = 'block';
    document.getElementById('profilePhotoPlaceholder').style.display = 'none';
    document.getElementById('navAvatar').innerHTML = `<img src="${u.foto}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
  }

  // Member card
  document.getElementById('mcName').textContent = u.nama;
  document.getElementById('mcBirth').textContent = `ğŸ“ ${u.tempat} / ${formatDate(u.tglLahir)}`;
  document.getElementById('mcNum').textContent = `No. Jemaat: ${u.nomorAnggota}`;
  document.getElementById('mcKomisi').textContent = u.komisi;
  document.getElementById('mcBarcodeLabel').textContent = u.nomorAnggota;

  if (u.foto) {
    document.getElementById('mcPhoto').src = u.foto;
  }

  // Kartu info
  document.getElementById('infoNama').textContent = u.nama;
  document.getElementById('infoBirth').textContent = `${u.tempat} / ${formatDate(u.tglLahir)}`;
  document.getElementById('infoNomor').textContent = u.nomorAnggota;
  document.getElementById('infoKomisi').textContent = u.komisi;
  document.getElementById('infoGabung').textContent = formatDate(u.tglBergabung);

  // Barcode info
  document.getElementById('bcNomor').textContent = u.nomorAnggota;
  document.getElementById('bcInfo1').textContent = u.nomorAnggota;
  document.getElementById('bcInfo2').textContent = u.ktp;
  document.getElementById('bcInfo3').textContent = u.komisi;
  document.getElementById('bcInfo4').textContent = formatDate(u.tglBergabung);

  // Generate barcodes
  setTimeout(() => {
    try {
      JsBarcode('#barcodeCanvas', u.nomorAnggota, {
        format: 'CODE128', width: 2, height: 70,
        displayValue: false, background: '#ffffff', lineColor: '#222831'
      });
      JsBarcode('#mcBarcode', u.nomorAnggota, {
        format: 'CODE128', width: 1.5, height: 30,
        displayValue: false, background: 'transparent', lineColor: '#DFD0B8'
      });
    } catch(e) {}
  }, 200);
}

// ==================== NAVIGATION ====================
function navigate(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
  const el = document.getElementById('page-' + page);
  if (el) el.classList.add('active');
  const nav = document.getElementById('nav-' + page);
  if (nav) nav.classList.add('active');
  if (window.innerWidth <= 768) document.getElementById('sidebar').classList.remove('open');
  return false;
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
}

// ==================== THEME ====================
function toggleTheme() {
  appState.theme = appState.theme === 'light' ? 'dark' : 'light';
  applyTheme(appState.theme);
  localStorage.setItem('gki_theme', appState.theme);
}

function applyTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  const isDark = theme === 'dark';
  const btn = document.getElementById('themeBtn');
  const btn2 = document.getElementById('themeToggleBtn');
  if (btn) btn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
  if (btn2) btn2.textContent = isDark ? 'â˜€ï¸ Light Mode' : 'ğŸŒ™ Dark Mode';
}

// ==================== CALENDAR ====================
function updateCalendar() {
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth();
  document.getElementById('calMonthLabel').textContent = now.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });

  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const todayDate = now.getDate();

  const grid = document.getElementById('calGrid');
  const days = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
  grid.innerHTML = days.map(d => `<div class="cal-day header">${d}</div>`).join('');

  for (let i = 0; i < firstDay; i++) grid.innerHTML += `<div class="cal-day empty"></div>`;
  for (let d = 1; d <= daysInMonth; d++) {
    const date = new Date(year, month, d);
    const isSunday = date.getDay() === 0;
    const isToday = d === todayDate;
    let cls = 'cal-day';
    if (isToday) cls += ' today';
    else if (isSunday) cls += ' ibadah';
    grid.innerHTML += `<div class="${cls}">${d}</div>`;
  }
}

// ==================== COUNTDOWNS ====================
function updateCountdowns() {
  const now = new Date();
  const dayOfWeek = now.getDay(); // 0=Sun
  const daysUntilSunday = dayOfWeek === 0 ? 0 : 7 - dayOfWeek;

  const schedules = [
    { hour: 7, id: 'cd1' },
    { hour: 10, id: 'cd2' },
    { hour: 17, id: 'cd3' }
  ];

  schedules.forEach(({ hour, id }) => {
    const target = new Date(now);
    if (daysUntilSunday > 0) {
      target.setDate(target.getDate() + daysUntilSunday);
    }
    target.setHours(hour, 0, 0, 0);
    if (target <= now) target.setDate(target.getDate() + 7);

    const diff = target - now;
    const dd = Math.floor(diff / 86400000);
    const hh = Math.floor((diff % 86400000) / 3600000);
    const mm = Math.floor((diff % 3600000) / 60000);

    let label = '';
    if (dd > 0) label = `${dd}h ${hh}j lagi`;
    else if (hh > 0) label = `${hh}j ${mm}m lagi`;
    else label = `${mm}m lagi`;

    const el = document.getElementById(id);
    if (el) el.textContent = label;
  });

  // Dashboard next service
  const { id } = schedules[0];
  const next = document.getElementById('cd1');
  if (next && document.getElementById('dashIbadah')) {
    const daysLeft = dayOfWeek === 0 ? 0 : 7 - dayOfWeek;
    const label = daysLeft === 0 ? 'Hari ini' : `${daysLeft} hari lagi`;
    document.getElementById('dashIbadah').textContent = `Minggu â€” ${label}`;
  }
}

// ==================== GREETING ====================
function updateGreeting() {
  const now = new Date();
  const h = now.getHours();
  let greet = h < 11 ? 'Selamat Pagi' : h < 15 ? 'Selamat Siang' : h < 18 ? 'Selamat Sore' : 'Selamat Malam';
  const name = appState.user ? `, ${appState.user.nama.split(' ')[0]}` : '';
  document.getElementById('greetingText').textContent = `${greet}${name} ğŸ‘‹`;
  document.getElementById('greetingDate').textContent = now.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  document.getElementById('renDate').textContent = now.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
}

// ==================== KOMISI CHECK ====================
function checkKomisi() {
  const dob = document.getElementById('checkDOB').value;
  if (!dob) { showNotif('Masukkan tanggal lahir!'); return; }
  const k = getKomisiFromDOB(dob);
  const icons = { 'Sekolah Minggu': 'ğŸ§’', 'Komisi Remaja': 'ğŸ§‘', 'Komisi Dewasa': 'ğŸ§‘â€ğŸ’¼', 'Komisi Lansia': 'ğŸ‘´' };
  const res = document.getElementById('komisiResult');
  res.style.display = 'block';
  res.innerHTML = `<strong>${icons[k]} Kategori Anda: ${k}</strong><br><span style="font-size:0.82rem;color:var(--text2);">Berdasarkan tanggal lahir yang dimasukkan.</span>`;
}

// ==================== TABS ====================
function showTab(activeId, showId) {
  ['ytContent', 'renContent', 'serContent'].forEach(id => {
    document.getElementById(id).style.display = id === showId ? 'block' : 'none';
  });
  document.querySelectorAll('.tab').forEach((t, i) => {
    const ids = ['tabYt', 'tabRen', 'tabSer'];
    t.classList.toggle('active', t.onclick && t.onclick.toString().includes(showId));
  });
  event.target.classList.add('active');
  event.target.parentNode.querySelectorAll('.tab').forEach(t => {
    if (t !== event.target) t.classList.remove('active');
  });
}

// ==================== CAMERA ====================
function openCamera(target) {
  appState.cameraTarget = target;
  document.getElementById('cameraModal').classList.add('open');
  navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } })
    .then(stream => {
      appState.stream = stream;
      document.getElementById('camVideo').srcObject = stream;
    })
    .catch(() => showNotif('Tidak dapat mengakses kamera.'));
}

function closeCamera() {
  document.getElementById('cameraModal').classList.remove('open');
  if (appState.stream) { appState.stream.getTracks().forEach(t => t.stop()); appState.stream = null; }
}

function capturePhoto() {
  const video = document.getElementById('camVideo');
  const canvas = document.getElementById('captureCanvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0);
  const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
  capturedPhotoData = dataUrl;

  const preview = document.getElementById('regPhotoPreview');
  preview.src = dataUrl;
  preview.style.display = 'block';
  document.getElementById('regPhotoCanvas').style.display = 'none';
  closeCamera();
  showNotif('Foto berhasil diambil!');
}

function previewPhoto(input) {
  if (!input.files[0]) return;
  const reader = new FileReader();
  reader.onload = e => {
    capturedPhotoData = e.target.result;
    const preview = document.getElementById('regPhotoPreview');
    preview.src = e.target.result;
    preview.style.display = 'block';
  };
  reader.readAsDataURL(input.files[0]);
}

function previewKK(input) {
  if (!input.files[0]) return;
  document.getElementById('kkLabel').textContent = 'âœ… ' + input.files[0].name;
}

// ==================== DOWNLOAD ====================
function downloadCard() {
  html2canvas(document.getElementById('memberCardEl'), { scale: 2, useCORS: true }).then(canvas => {
    const link = document.createElement('a');
    link.download = `kartu-jemaat-${appState.user?.nomorAnggota || 'gki'}.png`;
    link.href = canvas.toDataURL();
    link.click();
  });
}

function printCard() {
  html2canvas(document.getElementById('memberCardEl'), { scale: 2, useCORS: true }).then(canvas => {
    const win = window.open('');
    win.document.write(`<img src="${canvas.toDataURL()}" style="max-width:100%;">`);
    win.print();
  });
}

function downloadBarcode() {
  const canvas = document.getElementById('barcodeCanvas');
  const link = document.createElement('a');
  link.download = `barcode-${appState.user?.nomorAnggota || 'gki'}.png`;
  link.href = canvas.toDataURL();
  link.click();
}

// ==================== JEMAAT TABLE ====================
function populateJemaatTable() {
  const tbody = document.getElementById('jemaatBody');
  if (!tbody) return;
  tbody.innerHTML = '';
  const komisiColors = {
    'Sekolah Minggu': 'badge-orange',
    'Komisi Remaja': 'badge-blue',
    'Komisi Dewasa': 'badge-green',
    'Komisi Lansia': 'badge-purple'
  };
  appState.members.forEach((m, i) => {
    const isMe = appState.user && m.ktp === appState.user.ktp;
    tbody.innerHTML += `
      <tr id="row-${i}">
        <td>${i + 1}</td>
        <td>${m.nama} ${isMe ? '<span class="badge badge-green" style="font-size:0.65rem;">Saya</span>' : ''}</td>
        <td><code>${m.nomorAnggota}</code></td>
        <td><span class="badge ${komisiColors[m.komisi] || 'badge-sm'}">${m.komisi}</span></td>
        <td>${formatDate(m.tglBergabung)}</td>
        <td style="display:flex;gap:6px;flex-wrap:wrap;">
          <button class="btn btn-sm btn-outline" onclick="viewMember(${i})">ğŸ‘ Detail</button>
          <button class="btn btn-sm" style="background:#fee2e2;color:#b91c1c;border:none;border-radius:8px;padding:6px 12px;font-family:'Poppins',sans-serif;font-size:0.78rem;font-weight:600;cursor:pointer;" onclick="confirmDelete(${i})">ğŸ—‘ Hapus</button>
        </td>
      </tr>`;
  });
  if (!appState.members.length) {
    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--text2);">Belum ada data jemaat terdaftar.</td></tr>';
  }
}

function filterJemaat(q) {
  const rows = document.querySelectorAll('#jemaatBody tr');
  rows.forEach(r => {
    r.style.display = r.textContent.toLowerCase().includes(q.toLowerCase()) ? '' : 'none';
  });
}

function viewMember(i) {
  const m = appState.members[i];
  const modal = document.getElementById('detailModal');
  document.getElementById('detailContent').innerHTML = `
    <div style="display:flex;gap:16px;align-items:flex-start;margin-bottom:16px;">
      <div style="width:60px;height:75px;border-radius:10px;background:var(--surface);overflow:hidden;flex-shrink:0;">
        ${m.foto ? `<img src="${m.foto}" style="width:100%;height:100%;object-fit:cover;">` : '<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;">ğŸ‘¤</div>'}
      </div>
      <div>
        <div style="font-weight:700;font-size:1.05rem;">${m.nama}</div>
        <div style="font-size:0.8rem;color:var(--text2);">${m.komisi}</div>
        <span class="badge badge-green" style="margin-top:4px;">Anggota Aktif</span>
      </div>
    </div>
    <div style="display:flex;flex-direction:column;gap:10px;font-size:0.85rem;">
      <div style="display:flex;justify-content:space-between;border-bottom:1px solid var(--surface);padding-bottom:8px;"><span style="color:var(--text2);">No. Anggota</span><strong>${m.nomorAnggota}</strong></div>
      <div style="display:flex;justify-content:space-between;border-bottom:1px solid var(--surface);padding-bottom:8px;"><span style="color:var(--text2);">No. KTP</span><strong>${m.ktp}</strong></div>
      <div style="display:flex;justify-content:space-between;border-bottom:1px solid var(--surface);padding-bottom:8px;"><span style="color:var(--text2);">Tempat Lahir</span><strong>${m.tempat}</strong></div>
      <div style="display:flex;justify-content:space-between;border-bottom:1px solid var(--surface);padding-bottom:8px;"><span style="color:var(--text2);">Tgl. Lahir</span><strong>${formatDate(m.tglLahir)}</strong></div>
      <div style="display:flex;justify-content:space-between;"><span style="color:var(--text2);">Tgl. Bergabung</span><strong>${formatDate(m.tglBergabung)}</strong></div>
    </div>
    <div style="margin-top:20px;display:flex;gap:8px;">
      <button class="btn btn-outline btn-sm" onclick="closeDetailModal()">Tutup</button>
      <button class="btn btn-sm" style="background:#fee2e2;color:#b91c1c;border:none;border-radius:8px;padding:8px 16px;font-family:'Poppins',sans-serif;font-size:0.8rem;font-weight:600;cursor:pointer;" onclick="closeDetailModal();confirmDelete(${i})">ğŸ—‘ Hapus Anggota</button>
    </div>
  `;
  modal.classList.add('open');
}

function closeDetailModal() {
  document.getElementById('detailModal').classList.remove('open');
}

function confirmDelete(i) {
  const m = appState.members[i];
  const modal = document.getElementById('confirmModal');
  document.getElementById('confirmMsg').textContent = `Hapus "${m.nama}" (${m.nomorAnggota}) dari data jemaat?`;
  document.getElementById('confirmYes').onclick = () => { deleteMember(i); closeConfirmModal(); };
  modal.classList.add('open');
}

function closeConfirmModal() {
  document.getElementById('confirmModal').classList.remove('open');
}

function deleteMember(i) {
  const m = appState.members[i];
  const isSelf = appState.user && m.ktp === appState.user.ktp;

  appState.members.splice(i, 1);
  localStorage.setItem('gki_members', JSON.stringify(appState.members));
  populateJemaatTable();
  showNotif(`Anggota "${m.nama}" berhasil dihapus.`);

  // Jika hapus akun sendiri, logout otomatis
  if (isSelf) {
    localStorage.removeItem('gki_session');
    setTimeout(() => {
      appState.user = null;
      document.getElementById('appWrap').style.display = 'none';
      document.getElementById('authWrap').style.display = 'flex';
      showLogin();
    }, 1500);
  }
}

// ==================== UTILS ====================
function formatDate(dateStr) {
  if (!dateStr) return 'â€”';
  return new Date(dateStr).toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' });
}

function showNotif(msg) {
  const el = document.getElementById('notif');
  el.textContent = msg;
  el.style.display = 'block';
  setTimeout(() => { el.style.display = 'none'; }, 3000);
}

// ==================== END ====================
</script>
</body>
</html>